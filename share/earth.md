# 一个字符，可以视为一个文字，也可以视为一个数字

### 读取字符的内容：用字符串和数字互转的API

每个字符当成256进制的数字看待，也就是8位的2进制数字，若字符的编码值超过8位2进制，那么取最后8位，也就是 & 255

```ts
// 字符转数字
'GIF'.charCodeAt(0) // 71
'GIF'.charCodeAt(1) // 73
'GIF'.charCodeAt(2) // 70

// 数字转字符
String.fromCharCode(71) // 'G'
String.fromCharCode(73) // 'I'
String.fromCharCode(70) // 'F'

// 十进制转2进制
(247).toString(2) // '11110111'
```

### unsigned 类型

256进制的2位数，比如 [144, 1] 的取值是 144 + 1 * 256 = 400

### 颜色表类型
颜色表是一个数组，数组的每一项是一个元组，表示颜色值
```ts
type red = number // 整形数字
type green = number // 整形数字
type blue = number // 整形数字
type rgb = [red, green, blue]
type colorTable = Array<rgb> // [ [0, 0, 0], [0, 0, 57] ]
```

## Header
```ts
[
  71, 73, 70, // 文件名 'G','I','F' 
  56, 57, 97, // 版本 '8', '9', 'a' 
  144, 1, // 逻辑屏幕宽度 144 + 1 * 256 = 400 
  144, 1, // 逻辑屏幕高度 144 + 1 * 256 = 400 
  247, /**
    11110111 [1, 111, 0, 111]
    1.全局颜色表标志 1Bit boolean 表示是否存在全局颜色表，如果是1则后面跟着全局颜色表
    2.色深的2进制位数 3Bits 0~7 表示 1～8，表示用2进制几位表示颜色数值，如果是8，实际表示的数值是 1 << 8 即大小是256，那么表示颜色取值区间就是0～0xff
    3. 排序标志 1Bit boolean 表示颜色表中是否把引用次数多的颜色排到前面了
    4. 全局颜色表大小 3Bits 0~7 表示 1～8，如果是8，实际表示的数值是 1 << 8 即大小是256，那么表示全局颜色表的数组长度是 256。
  */
  0, // 背景颜色索引值，0～255，比如是 0，表示从全局颜色表取 0 位的颜色值作为该图片的背景色
  0, // 像素纵横比，0～255，如果是0，像素纵横比是1:1，如果有值，取 (Ratio + 15) / 64 也就是从 4:1 到 1:4 之间
  0,0,0,0,0,57,0,0,65,0,0,49,0,0,8,0,0,41,0,0,32,0,0,24,0,0,16,0,0,74,32,41,32,16,24,16,0,8,65,8,8,0,8,8,8,0,8,57,8,16,0,24,32,16,24,41,0,41,41,32,0,8,74,0,8,49,32,41,8,24,32,0,16,16,8,41,32,16,16,8,0,32,49,8,41,57,8,24,32,8,24,24,24,8,8,57,16,16,16,24,24,8,24,49,0,41,41,16,57,57,82,0,8,41,0,32,90,115,98,65,0,8,16,98,74,57,16,16,41,57,41,41,57,82,24,49,49,32,106,90,57,57,57,32,24,57,41,0,8,24,0,32,49,8,8,41,32,24,41,82,65,57,16,32,41,0,8,8,49,49,49,148,139,106,41,57,16,82,65,32,131,115,74,32,32,24,57,74,57,57,57,57,41,41,24,49,49,16,0,24,82,32,32,32,90,82,49,16,32,57,16,32,24,41,41,41,16,16,24,41,65,24,82,82,41,74,74,41,49,65,8,32,32,16,24,16,24,32,32,49,57,57,16,98,90,49,49,57,16,0,16,24,0,16,49,0, // 全局颜色表，每3位表示一个颜色，即rgb
]
```

## 帧图像描述块
```ts
[
  44, // 帧图像描述块的启始符号，即 ','
  0, 0, // 当前帧位图的 left 值，即 0 + 0 << 8 = 0
  0, 0, // 当前帧位图的 top 值，即 0 + 0 << 8 = 0
  144, 1, // 当前帧位图的 width 值，即 144 + 1 << 8 = 400
  144, 1, // 当前帧位图的 height 值，即 144 + 1 << 8 = 400
  0, /**
    '00000000' [0, 0, 0, 00, 000]
    1. 局部颜色表标识 1Bit boolean，如果是1则后面跟着局部颜色表
    2. 插行标识 1Bit boolean
    3. 排序标志 1Bit boolean 表示颜色表中是否把引用次数多的颜色排到前面了
    4. 冗余保留位，无意义 2Bit
    5. 局部颜色表大小 3Bits 0~7 表示 1～8，如果是8，实际表示的数值是 1 << 8 即大小是256，那么表示全局颜色表的数组长度是 256。
  */
  // 因为 局部颜色表标识 是0，所以没有局部颜色表，后面是图像数据块
  8, // LZW最小代码大小
  
  // LZW多个数据子块
  255, // LZW数据子块长度，值是0时表示LZW数据子块结束
  0,1,8,28,40,112,143,31,53,43,244,0,216,67,176,161,195,130,3,247,236,241,160,240,33,65,39,22,51,106,220,200,177,163,199,143,32,1,16,24,25,178,100,73,2,147,4,229,19,36,104,18,1,147,48,99,202,156,73,115,230,72,146,53,23,14,97,56,115,143,30,51,57,28,228,28,74,180,168,198,151,70,103,94,18,200,199,16,66,64,160,40,1,40,35,84,32,210,164,88,179,106,253,120,53,39,136,154,6,107,148,225,185,181,172,217,161,124,200,102,93,10,0,144,160,26,128,12,77,146,58,132,237,217,187,120,243,234,37,203,112,143,19,61,93,245,114,21,124,178,35,213,136,91,39,77,90,169,56,48,225,199,144,35,135,20,106,87,34,206,172,55,109,34,0,133,228,178,100,0,75,29,127,6,77,9,129,226,73,8,70,171,94,189,218,96,67,181,172,27,142,164,4,10,148,203,213,162,113,19,64,192,59,119,108,147,67,126,11,239,88,113,160,111,214,123,80,130,50,20,117,116,230,134,118,157,223,60,62,220,99,25,130,176,171,111,165,110,241,72,14,39,47,253,148, // LZW数据子块内容

  0, // LZW数据子块长度，值是0时表示LZW数据子块结束
]
```
### 像素插行

以20行为例，正常的像素行号排序是 [0, 1, 2, 3, 4, ..., 19]
GIF89a的插行是分4步
1. 从第 0 行开始间隔 8 行插入，即像素行号排序 0, 8, 16
2. 从第 4 行开始间隔 8 行插入，即像素行号排序 4, 12
3. 从第 2 行开始间隔 4 行插入，即像素行号排序 2, 6, 10, 14, 18
4. 从第 1 行开始间隔 2 行插入，即像素行号排序 1, 3, 5, 7, 9, 11, 13, 15, 17, 19


## 图形扩展块，作用范围是紧跟着的帧图像块
```ts
[
  33, // 扩展块启始符号，固定值 33，即 '!'
  249, // 图像扩展块启始符号
  4, // 块的 Bits 大小，固定为 4
  4, /**
    000 001 0 0
    1. 保留字节 3Bits 无意义
    2. 处置函数 3Bits {'1': '下一帧要用到当前帧', '2': '底板用背景色', '3': '底板用上一帧'}
    3. 用户输入标识 1Bit boolean，是否需要等待用户输入，一般不处理
    4. 透明度启用标识 1Bit boolean，若为1，那么后面有透明度索引
   */
  9, 0// 当前帧的停留时长，单位是10ms，即 (9 + 0 * 256) * 10 = 90ms
  255, // 透明度值，0～255
  0 // 扩展块结束符号
]
```

## 注释扩展块
1. 扩展块启始符号，固定值 33，即 '!'
2. 注释扩展块启始符号，固定值 254
3. 注释数据 Sub-blocks 类型
4. 扩展块结束符号,固定值 0

## GIF文件结束标识符号：';'即59

有的GIF文件没有结束符号，文件尾部填充的是大量的\x00

#####
TODO LZW算法解释
TODO pte块和app块解释
TODO GIF文件类型元组 [header, 帧图像块|图像扩展块|注释扩展块|pte扩展块|app扩展块 ,结束符号]