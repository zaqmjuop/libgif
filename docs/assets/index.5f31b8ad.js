(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();const X="/libgif/assets/coug3.f85a27a3.gif",q="/libgif/assets/earth.b0acdc9a.gif",Y="/libgif/assets/img5.64bf3f88.gif",J="/libgif/assets/gif1.5bf04440.gif",Q="/libgif/assets/gif2.ba77dc11.gif",V="/libgif/assets/gif3.0e5e59d6.gif",M=[X,q,J,Q,V,Y];function Z(s){return{all:s=s||new Map,on:function(t,e){var r=s.get(t);r?r.push(e):s.set(t,[e])},off:function(t,e){var r=s.get(t);r&&(e?r.splice(r.indexOf(e)>>>0,1):s.set(t,[]))},emit:function(t,e){var r=s.get(t);r&&r.slice().map(function(a){a(e)}),(r=s.get("*"))&&r.slice().map(function(a){a(t,e)})}}}class P{constructor(){this.emitter=Z()}on(t,e){return this.emitter.on(t,e)}off(t,e){return this.emitter.off(t,e)}emit(t,e){return this.emitter.emit(t,e)}}const B=new P,O=()=>({data:void 0,progress:0,error:void 0}),y={},tt=s=>{if(s in y)return;y[s]=O();const t={...y[s],key:s};B.emit("record",t)},et=(s,t)=>{y[s]=y[s]||O(),y[s].data=t;const e=100;y[s].progress=e;const r={key:s,data:t,progress:e};B.emit("downloaded",r)},st=(s,t,e)=>{y[s]=y[s]||O(),y[s].progress=t,y[s].data=e;const r={key:s,data:e,progress:t};B.emit("progress",r)},rt=(s,t)=>{y[s]=y[s]||O(),y[s].error=t;const e={...y[s],key:s};B.emit("error",e)},at=s=>{var t;return((t=y[s])==null?void 0:t.progress)>=100?"downloaded":s in y?"record":"none"},it=s=>y[s],g={getDownloadStatus:at,addRecord:tt,setProgress:st,setError:rt,setDownload:et,getDownload:it,on:B.on.bind(B),off:B.off.bind(B)},ot=async s=>(g.addRecord(s),await new Promise((t,e)=>{const r=new XMLHttpRequest;r.open("GET",s,!0),"overrideMimeType"in r?r.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in r?r.responseType="arraybuffer":r.setRequestHeader("Accept-Charset","x-user-defined"),r.onloadstart=()=>{},r.onload=a=>{r.status!=200&&(g.setError(s,"xhr - response"),e("xhr - response"));let i="";typeof r.response=="string"?i=r.response:r.response.toString().indexOf("ArrayBuffer")>0&&(i=new Uint8Array(r.response)),g.setProgress(s,100,i),t(i)},r.onprogress=a=>{const i=a.currentTarget?a.currentTarget.response:"";a.lengthComputable&&g.setProgress(s,a.loaded/a.total,i)},r.onerror=()=>{g.setError(s,"xhr"),e("xhr")},r.send()})),nt=async s=>{const t=g.getDownloadStatus(s);return t==="downloaded"||(t==="none"&&ot(s).then(e=>g.setDownload(s,e)),await new Promise(e=>{const r=a=>{a.key===s&&(g.off("downloaded",r),e(a.data))};g.on("downloaded",r)})),g.getDownload(s)},F=(s,t)=>{const e=s[t];if(typeof e!="function")throw new TypeError(`${String(t)} on ${String(s)} is not a Function`);return e.bind(s)},I=new P,u={},N=()=>({header:void 0,frames:[],blocks:[],complete:!1}),ht=s=>{u[s]=u[s]||N(),I.emit("record",{key:s,...u[s]})},ct=(s,t)=>{u[s]=u[s]||N(),u[s].header=t,I.emit("header",{key:s,...u[s]})},dt=(s,t)=>{u[s]=u[s]||N(),u[s].frames.push(...t),I.emit("frame",{key:s,...u[s]})},lt=(s,t)=>{u[s]=u[s]||N(),u[s].blocks.push(...t),I.emit("block",{key:s,...u[s]})},ut=s=>{u[s]=u[s]||N(),u[s].complete=!0,I.emit("decoded",{key:s,...u[s]})},pt=s=>{var t,e,r;return(t=u[s])!=null&&t.complete?"decoded":(e=u[s])!=null&&e.frames.length?"frame":(r=u[s])!=null&&r.header?"header":"none"},ft=s=>u[s],f={getDecodeStatus:pt,addRecord:ht,setHeader:ct,pushBlocks:lt,pushFrames:dt,setComplete:ut,getDecodeData:ft,on:I.on.bind(I),off:I.off.bind(I)},gt=["auto","downloaded","decoded","none"],mt=s=>gt.includes(s);class yt extends P{constructor(t){super(),this.t=0,this.playedFrameNos=new Set,this.loopCount=0,this.playing=!1,this.currentKey=void 0,this.finish=()=>{this.loopCount++,this.loop?this.goOn():(this.pause(),this.emit("playended"))},this.goOn=()=>{if(!this.playing)return;clearTimeout(this.t);const e=this.getNextFrameNo(),r=!this.framsComplete&&e===0?this.currentFrame:this.putFrame(e),a=r?r.delay:17,i=this.framsComplete&&this.getNextFrameNo()===0;this.t=window.setTimeout(i?this.finish:this.goOn,a/this.rate)},this.resetState=()=>{clearTimeout(this.t),this.i=this.beginFrameNo,this.loopCount=0,this.playing=!1,this.playedFrameNos.clear()},this.play=()=>{this.playing||(this.playing=!0,this.goOn(),this.emit("play"))},this.pause=()=>{this.playing=!1,this.emit("pause")},this.onError=()=>{this.resetState()},this.viewer=t.viewer,this.beginFrameNo=typeof t.beginFrameNo=="number"?t.beginFrameNo:0,this._forward=typeof t.forword=="boolean"?t.forword:!0,this._rate=typeof t.rate=="number"?t.rate:1,this._loop=typeof t.loop=="boolean"?t.loop:!0,this.autoplay=mt(t.autoplay)?t.autoplay:"auto",this.i=this.beginFrameNo}get rate(){return this._rate}set rate(t){t>=0&&(this._rate=t)}get forward(){return this._forward}set forward(t){this._forward=t}get loop(){return this._loop}set loop(t){this._loop=t}get currentImg(){return this.currentKey&&f.getDecodeData(this.currentKey)||void 0}get header(){const t=this.currentImg;if(t!=null&&t.header)return{width:t.header.logicalScreenWidth,height:t.header.logicalScreenHeight}}get framsComplete(){var t;return!!((t=this.currentImg)!=null&&t.complete)}get frameGroup(){return this.currentImg?this.currentImg.frames:[]}get readyStatus(){return this.currentKey?f.getDecodeStatus(this.currentKey):"none"}get currentFrame(){return this.frameGroup[this.i]}get currentFrameNo(){return this.i}getNextFrameNo(){const t=this.frameGroup.length;if(!t)return t;const e=this.forward?1:-1;return(this.i+e+t)%t}putFrame(t){const e=this.frameGroup[t];return e&&e.data!==this.viewer.currentImgData&&(this.i=t,this.viewer.putDraft(e.data,e.leftPos,e.topPos),this.viewer.drawDraft(),this.playedFrameNos.add(this.i),this.emit("frameChange")),e}async prepare(){const t=()=>{const e=this.header;return e&&this.viewer.setDraftSize(e),!!e};t()||await new Promise(e=>{const r=()=>t()&&e(f.off("header",r));f.on("header",r)})}async switch(t){this.resetState(),this.currentKey=t,await this.prepare(),this.putFrame(0),this.play()}}const A=s=>s.reduce((t,e)=>t*2+Number(e),0),L=s=>{const t=[];for(let e=7;e>=0;e--)t.push(!!(s&1<<e));return t};class wt{constructor(t=""){this.data="",this.len=0,this.pos=0,this.emitter=new P,this.readByte=async()=>new Promise(e=>{const r=()=>{try{const a=this.readByteSync();this.emitter.off("data",r),e(a)}catch{}};this.emitter.on("data",r),r()}),this.readBytes=async e=>{const r=[];for(let a=0;a<e;a++){const i=await this.readByte();r.push(i)}return r},this.read=async e=>{let r="";for(let a=0;a<e;a++){const i=await this.readByte();r+=String.fromCharCode(i)}return r},this.readUnsigned=async()=>{const[e,r]=await this.readBytes(2);return(r<<8)+e},this.setData(t)}setData(t){this.data=t,this.len=this.data.length,this.emitter.emit("data")}readByteSync(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return this.data instanceof Uint8Array?this.data[this.pos++]:this.data.charCodeAt(this.pos++)&255}}const vt=()=>{let s=0;return()=>(s>65535&&(s=-s),s++)},K=s=>{const t=new Worker("/libgif/dist/assets/funcWorker.b86fc165.js",{type:"module"}),e=vt();return async(...r)=>{const a=e();return new Promise(i=>{const n=h=>{h.data.traceId===a&&(t.removeEventListener("message",n),i(h.data.data))};t.addEventListener("message",n),t.postMessage({args:r,traceId:a,funcName:s})})}},bt={"":K(""),lzwDecode:K("lzwDecode")},xt=bt.lzwDecode;class Ct{constructor(){this.canvas=document.createElement("canvas"),this.st=null,this.key="",this.exts=[],this.opacity=255,this.frameGroup=[],this.parseColorTable=async t=>{if(!this.st)return;const e=[];for(let r=0;r<t;r++)e.push(await this.st.readBytes(3));return e},this.readSubBlocks=async()=>{if(!this.st)return;let t,e;e="";do t=await this.st.readByte(),e+=await this.st.read(t);while(t!==0);return e},this.parseHeader=async()=>{if(!this.st)return;const t=await this.st.read(3),e=await this.st.read(3);if(t!=="GIF")throw new Error("Not a GIF file.");const r=await this.st.readUnsigned(),a=await this.st.readUnsigned(),i=L(await this.st.readByte()),n=!!i.shift(),h=A(i.splice(0,3)),d=!!i.shift(),o=A(i.splice(0,3)),c=await this.st.readByte(),p=await this.st.readByte(),w=n?await this.parseColorTable(1<<o+1):void 0,D=w?w[c]:null,m={signature:t,version:e,logicalScreenWidth:r,logicalScreenHeight:a,globalColorTableFlag:n,ColorResolution:h,sortFlag:d,ColorTableSize:o,backgroundColorIndex:c,backgroundColor:D,pixelAspectRatio:p,globalColorTable:w};return this.header=m,this.setCanvasSize(m.logicalScreenWidth,m.logicalScreenHeight),f.setHeader(this.key,m),m},this.parseExt=async t=>{if(!this.st)return;const e=async o=>{if(!this.st)return;await this.st.readByte();const c=L(await this.st.readByte()),p=c.splice(0,3),w=A(c.splice(0,3)),D=!!c.shift(),m=!!c.shift(),x=await this.st.readUnsigned()*10,l=await this.st.readByte(),v=await this.st.readByte(),T={...o,reserved:p,disposalMethod:w,userInput:D,transparencyGiven:m,delayTime:x,transparencyIndex:l,terminator:v};this.graphControll=T},r=async o=>{if(!this.st)return;const c=await this.readSubBlocks(),p={...o,comment:c};return this.exts.push(p),f.pushBlocks(this.key,[p]),p},a=async o=>{if(!this.st)return;await this.st.readByte();const c=await this.st.readBytes(12),p=await this.readSubBlocks(),w={...o,ptHeader:c,ptData:p};return this.exts.push(w),f.pushBlocks(this.key,[w]),w},i=async o=>{if(!this.st)return;const c=async x=>{if(!this.st)return;await this.st.readByte();const l=await this.st.readByte(),v=await this.st.readUnsigned(),T=await this.st.readByte(),S={...x,unknown:l,iterations:v,terminator:T,identifier:"NETSCAPE"};return this.app=S,f.pushBlocks(this.key,[S]),S},p=async x=>{const l=await this.readSubBlocks(),v={...x,appData:l,identifier:x.identifier};return this.app=v,f.pushBlocks(this.key,[v]),v};await this.st.readByte();const w=await this.st.read(8),D=await this.st.read(3),m={...o,identifier:w,authCode:D};switch(m.identifier){case"NETSCAPE":await c(m);break;default:await p(m);break}return m},n=async o=>{const c=await this.readSubBlocks(),p={...o,data:c};return this.exts.push(p),f.pushBlocks(this.key,[p]),p},h=await this.st.readByte(),d={...t,label:h,extType:""};switch(d.label){case 249:return d.extType="gce",e(d);case 254:return d.extType="com",r(d);case 1:return d.extType="pte",a(d);case 255:return d.extType="app",i(d);default:return d.extType="unknown",n(d)}},this.parseImg=async t=>{if(!this.st)return;const e=(S,C)=>{const E=new Array(S.length),z=S.length/C,G=(k,$)=>{const j=S.slice($*C,($+1)*C);E.splice(k*C,C,...j)},R=[0,4,2,1],U=[8,8,4,2];let b=0;for(let k=0;k<4;k++)for(let $=R[k];$<z;$+=U[k])G($,b),b++;return E},r=await this.st.readUnsigned(),a=await this.st.readUnsigned(),i=await this.st.readUnsigned(),n=await this.st.readUnsigned(),h=L(await this.st.readByte()),d=h.shift(),o=h.shift(),c=h.shift(),p=h.splice(0,2),w=A(h.splice(0,3)),D=d?await this.parseColorTable(1<<w+1):void 0,m=await this.st.readByte(),x=await this.readSubBlocks();let l=await xt(m,x);o&&(l=e(l,i));const v={...t,leftPos:r,topPos:a,width:i,height:n,lctFlag:d,interlaced:o,sorted:c,reserved:p,lctSize:w,lct:D,lzwMinCodeSize:m,pixels:l},T=this.parseFrame(v);return{...v,frame:T}},this.parseFrame=t=>{var e;const r=this.graphControll;r&&this.disposal(r.disposalMethod);const a=r&&r.transparencyGiven?r.transparencyIndex:null,i=r&&r.delayTime||100,n=t.lctFlag?t.lct:(e=this.header)==null?void 0:e.globalColorTable,h=this.ctx.getImageData(t.leftPos,t.topPos,t.width,t.height);n&&t.pixels.forEach((o,c)=>{o!==a&&(h.data[c*4+0]=n[o][0],h.data[c*4+1]=n[o][1],h.data[c*4+2]=n[o][2],h.data[c*4+3]=this.opacity)}),this.ctx.putImageData(h,t.leftPos,t.topPos,0,0,t.width,t.height);const d={data:this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),delay:i,leftPos:0,topPos:0,width:this.canvas.width,height:this.canvas.height};return this.frameGroup.push(d),this.graphControll=void 0,f.pushFrames(this.key,[d]),d},this.putDraft=(t,e=0,r=0)=>{const{width:a,height:i}=this.canvas;t?t instanceof ImageData?this.ctx.putImageData(t,e,r):(this.ctx.fillStyle=`rgb(${t.join(",")} )`,this.ctx.fillRect(0,0,a,i)):this.ctx.clearRect(0,0,a,i)},this.parseBlock=async()=>{if(!this.st)return;const t={sentinel:await this.st.readByte(),type:""},e=()=>(t.type="complete",this.st=null,this.key="",t);switch(String.fromCharCode(t.sentinel)){case"!":return t.type="ext",this.parseExt(t);case",":return t.type="img",this.parseImg(t);case";":return e();case"\0":return e();default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}},this.parse=async(t,e,r)=>{if(this.st)return;this.st=t,this.key=e,r&&(this.opacity=r.opacity);const a=[],i=await this.parseHeader();for(;this.st;){const h=await this.parseBlock();h&&a.push(h)}const n={header:i,blocks:a,frameGroup:this.frameGroup,opacity:this.opacity};return f.setComplete(e),n},this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0})}get pos(){var t;return((t=this.st)==null?void 0:t.pos)||0}get len(){var t;return((t=this.st)==null?void 0:t.data.length)||0}get loading(){return!!this.st}setCanvasSize(t,e){this.canvas.width=t,this.canvas.height=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.ctx.setTransform(1,0,0,1,0,0)}disposal(t){const e=r=>{var a;const i=this.frameGroup[r];i?this.putDraft(i.data,i.leftPos,i.topPos):this.putDraft(((a=this.header)==null?void 0:a.backgroundColor)||null)};switch(t){case 3:e(this.frameGroup.length-1);break;case 2:e(-1);break}}}const kt=async(s,t)=>{f.addRecord(s);const e=g.getDownload(s),r=new wt(e.data||"");if(e.progress<100){const a=n=>{n.key===s&&r.setData(n.data)},i=n=>{n.key===s&&(r.setData(n.data),g.off("progress",a),g.off("downloaded",i))};g.on("progress",a),g.on("downloaded",i)}return await new Ct().parse(r,s,t)},Dt=async(s,t)=>{const e=f.getDecodeStatus(s);return e==="decoded"||(e==="none"&&kt(s,t),await new Promise(r=>{const a=()=>{f.off("decoded",a),r(void 0)};f.on("decoded",a)})),f.getDecodeData(s)};class St extends P{constructor(){super(),this.draftCanvas=document.createElement("canvas"),this.currentImgData=null,this.drawError=t=>{if(!this.canvas||!this.ctx)return;this.ctx.fillStyle="black";const e=this.canvas.width,r=this.canvas.height;this.ctx.fillRect(0,0,e,r),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.moveTo(0,0),this.ctx.lineTo(e,r),this.ctx.moveTo(0,r),this.ctx.lineTo(e,0),this.ctx.stroke()},this.resizeObserver=new ResizeObserver(this.onResize.bind(this)),this.draftCtx=this.draftCanvas.getContext("2d")}get scale(){var t,e;const r=((t=this.canvas)==null?void 0:t.width)||0,a=this.draftCanvas.width,i=((e=this.canvas)==null?void 0:e.height)||0,n=this.draftCanvas.height;return{zoomW:r/a,zoomH:i/n}}updateScale(){var t,e;(t=this.ctx)==null||t.setTransform(1,0,0,1,0,0);const{zoomW:r,zoomH:a}=this.scale;(e=this.ctx)==null||e.scale(r,a)}onResize(){!this.canvas||!this.ctx||(this.updateScale(),this.drawDraft())}mount(t){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.resizeObserver.observe(t)}setDraftSize(t){!this.canvas||(this.draftCanvas.width=t.width,this.draftCanvas.height=t.height,this.draftCanvas.style.width=t.width+"px",this.draftCanvas.style.height=t.height+"px",this.draftCtx.setTransform(1,0,0,1,0,0),this.updateScale())}putDraft(t,e=0,r=0){const{width:a,height:i}=this.draftCanvas;this.currentImgData=t,t?t instanceof ImageData?this.draftCtx.putImageData(t,e,r,0,0,a,i):(this.draftCtx.fillStyle=`rgb(${t.join(",")} )`,this.draftCtx.fillRect(0,0,a,i)):this.draftCtx.clearRect(0,0,a,i)}drawDraft(){var t;(t=this.ctx)==null||t.drawImage(this.draftCanvas,0,0)}}const It=255,Bt=s=>{const t=new P,e=s.gif;let r=s.src||"";const a=new St;a.mount(e);const i=new yt({viewer:a,beginFrameNo:s.beginFrameNo,forword:s.forword,rate:s.rate,loop:s.loop,autoplay:s.autoplay}),n=o=>{o.key===r&&(i.onError(),a.drawError(o.error||""),t.emit("error",o))};g.on("error",n);const h=async o=>{r=o;try{g.getDownloadStatus(o)==="none"&&nt(o),f.getDecodeStatus(o)==="none"&&Dt(o,{opacity:It}),i.switch(o)}catch{const c={error:`load url error with\u3010${o}\u3011`};a.drawError(c.error),t.emit("error",c)}},d={get playing(){return i.playing},get loopCount(){return i.loopCount},get currentKey(){return i.currentKey},get currentFrameNo(){return i.currentFrameNo},get rate(){return i.rate},set rate(o){i.rate=o},get forward(){return i.forward},set forward(o){i.forward=o},get loop(){return i.loop},set loop(o){i.loop=o},play:F(i,"play"),pause:F(i,"pause"),jumpTo:F(i,"putFrame"),loadUrl:h,getDecodeData:F(f,"getDecodeData"),getDownload:F(g,"getDownload"),on:F(t,"on"),off:F(t,"off")};return i.on("play",o=>t.emit("play",o)),i.on("frameChange",o=>t.emit("frameChange",o)),i.on("pause",o=>t.emit("pause",o)),i.on("playended",o=>t.emit("playended",o)),f.on("decoded",o=>t.emit("decoded",o)),g.on("downloaded",o=>t.emit("downloaded",o)),g.on("progress",o=>t.emit("progress",o)),e.controller=d,r&&h(r),d};let H=0;const _=()=>(H>65535&&(H=-H),`${(H++).toString(16)}`),W=(s=0)=>{const t=_(),e=document.createElement("div");e.id=t,e.classList.add("example"),document.body.append(e);const r=M[s],a=_(),i=200,n=200;let h=1,d=1;const o=`${a}x`,c=`${a}y`,p=`${a}rate`,w=`${a}forword`,D=`${a}loop`,m=`${a}pause`;e.innerHTML=` 
    <div style="margin: 8px 0">
     ${M.map((b,k)=>`<button url="${b}">GIF${k}</button>`).join(" ")}
    </div>
    <div>
    <label>
      <span>width</span>
      <input id="${o}" type="range" max=20 min=1 step=2 value=${h*10}/>
    </label>
    <label>
      <span>height</span>
      <input id="${c}" type="range" max=20 min=1 step=2 value=${d*10}/>
    </label>
    <label>
      <span>rate</span>
      <input id="${p}" type="range" max=20 min=1 step=2 value=${10}/>
    </label>
    <div>
      <button id=${m}>pause</button>
      <button id=${w}>forword</button>
      <button id=${D}>loop</button>
    </div>

    </div>
    <canvas
      id="${a}" 
      width="${i}"
      height="${n}" 
    /> 
  `;const x=document.getElementById(a),l=Bt({gif:x,src:r});console.log(l);const v=document.getElementById(o),T=()=>{const b=v.value;h=parseInt(v.value)/10,v.setAttribute("value",b),x.width=i*h},S=()=>{const b=C.value;d=parseInt(C.value)/10,C.setAttribute("value",b),x.height=n*d};v&&(v.oninput=T);const C=document.getElementById(c);C&&(C.oninput=S);const E=document.getElementById(p);E.oninput=()=>{const b=parseInt(E.value);l.rate=b/10,E.value=`${b}`};const z=document.getElementById(w);z.onclick=()=>{l.forward=!l.forward,z.innerText=`forword:${l.forward}`};const G=document.getElementById(D);G.onclick=()=>{l.loop=!l.loop,G.innerText=`loop:${l.loop}`};const R=document.getElementById(m),U=()=>R.innerText=l.playing?"pause":"play";return R.onclick=()=>{l.playing?l.pause():l.play(),U()},l.on("playended",U),e.addEventListener("click",b=>{if(b.target instanceof HTMLElement){const k=b.target.getAttribute("url");k&&l.loadUrl(k)}}),l};W(0);W(1);
