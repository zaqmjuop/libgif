(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();const q="/libgif/assets/coug3.f85a27a3.gif",X="/libgif/assets/earth.b0acdc9a.gif",j="/libgif/assets/img5.64bf3f88.gif",Y="/libgif/assets/gif1.5bf04440.gif",Z="/libgif/assets/gif2.ba77dc11.gif",_="/libgif/assets/gif3.0e5e59d6.gif",R=[q,X,Y,Z,_,j];function J(s){return{all:s=s||new Map,on:function(t,e){var r=s.get(t);r?r.push(e):s.set(t,[e])},off:function(t,e){var r=s.get(t);r&&(e?r.splice(r.indexOf(e)>>>0,1):s.set(t,[]))},emit:function(t,e){var r=s.get(t);r&&r.slice().map(function(i){i(e)}),(r=s.get("*"))&&r.slice().map(function(i){i(t,e)})}}}class T{constructor(){this.emitter=J()}on(t,e){return this.emitter.on(t,e)}off(t,e){return this.emitter.off(t,e)}emit(t,e){return this.emitter.emit(t,e)}}const k=new T,F=()=>({data:void 0,progress:0,error:void 0}),y={},Q=s=>{if(s in y)return;y[s]=F();const t={...y[s],key:s};k.emit("record",t)},V=(s,t)=>{y[s]=y[s]||F(),y[s].data=t,y[s];const e={...y[s],key:s};k.emit("downloaded",e)},tt=(s,t,e)=>{y[s]=y[s]||F(),y[s].progress=t,e&&(y[s].data=e);const r={...y[s],key:s};k.emit("progress",r)},et=(s,t)=>{y[s]=y[s]||F(),y[s].error=t;const e={...y[s],key:s};k.emit("error",e)},st=s=>{var t;return((t=y[s])==null?void 0:t.progress)>=100?"downloaded":s in y?"record":"none"},rt=s=>y[s],w={getDownloadStatus:st,addRecord:Q,setProgress:tt,setError:et,setDownload:V,getDownload:rt,on:k.on.bind(k),off:k.off.bind(k)},it=async s=>(w.addRecord(s),await new Promise((t,e)=>{const r=new XMLHttpRequest;r.open("GET",s,!0),"overrideMimeType"in r?r.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in r?r.responseType="arraybuffer":r.setRequestHeader("Accept-Charset","x-user-defined"),r.onloadstart=()=>{},r.onload=i=>{r.status!=200&&(w.setError(s,"xhr - response"),e("xhr - response"));let a="";typeof r.response=="string"?a=r.response:r.response.toString().indexOf("ArrayBuffer")>0&&(a=new Uint8Array(r.response)),w.setProgress(s,100),t(a)},r.onprogress=i=>{i.lengthComputable&&w.setProgress(s,i.loaded/i.total)},r.onerror=()=>{w.setError(s,"xhr"),e("xhr")},r.send()})),U=async s=>{const t=w.getDownloadStatus(s);return t==="downloaded"||(t==="none"&&it(s).then(e=>w.setDownload(s,e)),await new Promise(e=>{const r=i=>{i.key===s&&(w.off("downloaded",r),e(i.data))};w.on("downloaded",r)})),w.getDownload(s)},C=new T,g={},A=()=>({header:void 0,frames:[],blocks:[],complete:!1}),at=s=>{g[s]=g[s]||A(),C.emit("record",{key:s,...g[s]})},ot=(s,t)=>{g[s]=g[s]||A(),g[s].header=t,C.emit("header",{key:s,...g[s]})},nt=(s,t)=>{g[s]=g[s]||A(),g[s].frames.push(...t),C.emit("frame",{key:s,...g[s]})},ht=(s,t)=>{g[s]=g[s]||A(),g[s].blocks.push(...t),C.emit("block",{key:s,...g[s]})},ct=s=>{g[s]=g[s]||A(),g[s].complete=!0,C.emit("decoded",{key:s,...g[s]})},lt=s=>{var t,e,r;return(t=g[s])!=null&&t.complete?"decoded":(e=g[s])!=null&&e.frames.length?"frame":(r=g[s])!=null&&r.header?"header":"none"},dt=s=>g[s],m={getDecodeStatus:lt,addRecord:at,setHeader:ot,pushBlocks:ht,pushFrames:nt,setComplete:ct,getDecodeData:dt,on:C.on.bind(C),off:C.off.bind(C)};class ut extends T{constructor(t){super(),this.i=0,this.loopCount=0,this.forward=!0,this.playing=!1,this.opacity=255,this.onFramed=!1,this.t=0,this.currentKey=void 0,this.prepared=!1,this.finish=()=>{var e;this.loopCount++,((e=this.quote.viewer.canvas)==null?void 0:e.getAttribute("loop"))==="loop"?this.goOn():this.pause()},this.goOn=()=>{if(!this.playing)return;clearTimeout(this.t);const e=this.putFrame(this.getNextFrameNo()),r=this.getNextFrameNo()===0&&this.framsComplete,i=(e==null?void 0:e.delay)||17;this.t=window.setTimeout(r?this.finish:this.goOn,i)},this.play=()=>{this.playing||(this.playing=!0,this.goOn(),this.emit("play"))},this.pause=()=>{this.playing=!1,this.emit("pause")},this.resetState=()=>{clearTimeout(this.t),this.i=0,this.loopCount=0,this.forward=!0,this.playing=!1,this.opacity=255,this.onFramed=!1,this.prepared=!1},this.onError=()=>{this.resetState()},this.quote=t}get currentImg(){return this.currentKey&&m.getDecodeData(this.currentKey)||void 0}get header(){const t=this.currentImg;if(t!=null&&t.header)return{width:t.header.logicalScreenWidth,height:t.header.logicalScreenHeight}}get framsComplete(){var t;return!!((t=this.currentImg)!=null&&t.complete)}get frameGroup(){return this.currentImg?this.currentImg.frames:[]}get readyStatus(){return this.currentKey?m.getDecodeStatus(this.currentKey):"none"}get currentFrame(){return this.frameGroup[this.i]}get currentFrameNo(){return this.i}getNextFrameNo(){const t=this.frameGroup.length;if(!t)return t;const e=this.forward?1:-1;return(this.i+e+t)%t}putFrame(t){const e=this.frameGroup[t];return e&&(this.i=t,this.quote.viewer.putDraft(e.data,e.leftPos,e.topPos),this.quote.viewer.drawDraft(),this.emit("frameChange")),e}async prepare(){const t=()=>{const e=this.header;return e&&this.quote.viewer.setDraftSize(e),!!e};t()||await new Promise(e=>{const r=()=>t()&&e(m.off("header",r));m.on("header",r)}),this.prepared=!0}async switch(t){this.resetState(),this.currentKey=t,await this.prepare(),this.play()}}const N=s=>s.reduce((t,e)=>t*2+Number(e),0),P=s=>{const t=[];for(let e=7;e>=0;e--)t.push(!!(s&1<<e));return t};class pt{constructor(t){this.pos=0,this.data=t,this.len=this.data.length}readByte(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return this.data instanceof Uint8Array?this.data[this.pos++]:this.data.charCodeAt(this.pos++)&255}readBytes(t){const e=[];for(let r=0;r<t;r++)e.push(this.readByte());return e}read(t){let e="";for(let r=0;r<t;r++)e+=String.fromCharCode(this.readByte());return e}readUnsigned(){const[t,e]=this.readBytes(2);return(e<<8)+t}}const ft=(s,t)=>{let e=0;const r=u=>{let o=0;for(let p=0;p<u;p++)(t instanceof Uint8Array?t[e>>3]:t.charCodeAt(e>>3))&1<<(e&7)&&(o|=1<<p),e++;return o},i=[],a=1<<s,c=a+1;let n=s+1,h=[];const f=()=>{n=s+1,h=[];for(let u=0;u<a;u++)h[u]=[u];h[a]=[],h[c]=null};let l=0,d;for(;;){if(d=l,l=r(n),l===a){f();continue}else{if(l===c)break;if(l>h.length)throw new Error("Invalid LZW code.");l===h.length?h.push(h[d].concat(h[d][0])):d!==a&&h.push(h[d].concat(h[l][0]))}if(i.push(...h[l]),h.length===1<<n&&n<12&&n++,e>=t.length*8)break}return i},gt=()=>{let s=0;return()=>(s>65535&&(s=-s),`${s++}`)},mt=s=>{const t=gt(),e=`
    const func = ${s.toString()};
    onmessage= async (event) => {
      const { traceId, args } = event.data
      const data = await func.apply(void 0, args)
      self.postMessage({ traceId, data })
    };
  `,r=new Worker(`data:application/javascript,${encodeURIComponent(e)}`);return async(...i)=>{const a=t();return new Promise(c=>{const n=h=>{h.data.traceId===a&&(r.removeEventListener("message",n),c(h.data.data))};r.addEventListener("message",n),r.postMessage({args:i,traceId:a})})}},yt=mt(ft);class wt{constructor(){this.canvas=document.createElement("canvas"),this.st=null,this.key="",this.exts=[],this.opacity=255,this.frameGroup=[],this.parseColorTable=t=>{if(!this.st)return;const e=[];for(let r=0;r<t;r++)e.push(this.st.readBytes(3));return e},this.readSubBlocks=()=>{if(!this.st)return;let t,e;e="";do t=this.st.readByte(),e+=this.st.read(t);while(t!==0);return e},this.parseHeader=()=>{if(!this.st)return;const t=this.st.read(3),e=this.st.read(3);if(t!=="GIF")throw new Error("Not a GIF file.");const r=this.st.readUnsigned(),i=this.st.readUnsigned(),a=P(this.st.readByte()),c=!!a.shift(),n=N(a.splice(0,3)),h=!!a.shift(),f=N(a.splice(0,3)),l=this.st.readByte(),d=this.st.readByte(),u=c?this.parseColorTable(1<<f+1):void 0,o=u?u[l]:null,p={signature:t,version:e,logicalScreenWidth:r,logicalScreenHeight:i,globalColorTableFlag:c,ColorResolution:n,sortFlag:h,ColorTableSize:f,backgroundColorIndex:l,backgroundColor:o,pixelAspectRatio:d,globalColorTable:u};return this.header=p,this.setCanvasSize(p.logicalScreenWidth,p.logicalScreenHeight),m.setHeader(this.key,p),p},this.parseExt=t=>{if(!this.st)return;const e=f=>{if(!this.st)return;this.st.readByte();const l=P(this.st.readByte()),d=l.splice(0,3),u=N(l.splice(0,3)),o=!!l.shift(),p=!!l.shift(),v=this.st.readUnsigned()*10,D=this.st.readByte(),b=this.st.readByte(),B={...f,reserved:d,disposalMethod:u,userInput:o,transparencyGiven:p,delayTime:v,transparencyIndex:D,terminator:b};this.graphControll=B},r=f=>{if(!this.st)return;const l=this.readSubBlocks(),d={...f,comment:l};return this.exts.push(d),m.pushBlocks(this.key,[d]),d},i=f=>{if(!this.st)return;this.st.readByte();const l=this.st.readBytes(12),d=this.readSubBlocks(),u={...f,ptHeader:l,ptData:d};return this.exts.push(u),m.pushBlocks(this.key,[u]),u},a=f=>{if(!this.st)return;const l=v=>{if(!this.st)return;this.st.readByte();const D=this.st.readByte(),b=this.st.readUnsigned(),B=this.st.readByte(),S={...v,unknown:D,iterations:b,terminator:B,identifier:"NETSCAPE"};return this.app=S,m.pushBlocks(this.key,[S]),S},d=v=>{const D=this.readSubBlocks(),b={...v,appData:D,identifier:v.identifier};return this.app=b,m.pushBlocks(this.key,[b]),b};this.st.readByte();const u=this.st.read(8),o=this.st.read(3),p={...f,identifier:u,authCode:o};switch(p.identifier){case"NETSCAPE":l(p);break;default:d(p);break}return p},c=f=>{const l=this.readSubBlocks(),d={...f,data:l};return this.exts.push(d),m.pushBlocks(this.key,[d]),d},n=this.st.readByte(),h={...t,label:n,extType:""};switch(h.label){case 249:return h.extType="gce",e(h);case 254:return h.extType="com",r(h);case 1:return h.extType="pte",i(h);case 255:return h.extType="app",a(h);default:return h.extType="unknown",c(h)}},this.parseImg=async t=>{if(!this.st)return;const e=(S,O)=>{const L=new Array(S.length),W=S.length/O,$=(E,I)=>{const K=S.slice(I*O,(I+1)*O);L.splice(E*O,O,...K)},H=[0,4,2,1],M=[8,8,4,2];let z=0;for(let E=0;E<4;E++)for(let I=H[E];I<W;I+=M[E])$(I,z),z++;return L},r=this.st.readUnsigned(),i=this.st.readUnsigned(),a=this.st.readUnsigned(),c=this.st.readUnsigned(),n=P(this.st.readByte()),h=n.shift(),f=n.shift(),l=n.shift(),d=n.splice(0,2),u=N(n.splice(0,3)),o=h?this.parseColorTable(1<<u+1):void 0,p=this.st.readByte(),v=this.readSubBlocks();let D=await yt(p,v);f&&(D=e(D,a));const b={...t,leftPos:r,topPos:i,width:a,height:c,lctFlag:h,interlaced:f,sorted:l,reserved:d,lctSize:u,lct:o,lzwMinCodeSize:p,pixels:D},B=this.parseFrame(b);return{...b,frame:B}},this.parseFrame=t=>{var e;const r=this.graphControll;r&&this.disposal(r.disposalMethod);const i=r&&r.transparencyGiven?r.transparencyIndex:null,a=r&&r.delayTime||100,c=t.lctFlag?t.lct:(e=this.header)==null?void 0:e.globalColorTable,n=this.ctx.getImageData(t.leftPos,t.topPos,t.width,t.height);c&&t.pixels.forEach((f,l)=>{f!==i&&(n.data[l*4+0]=c[f][0],n.data[l*4+1]=c[f][1],n.data[l*4+2]=c[f][2],n.data[l*4+3]=this.opacity)}),this.ctx.putImageData(n,t.leftPos,t.topPos,0,0,t.width,t.height);const h={data:this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),delay:a,leftPos:0,topPos:0,width:this.canvas.width,height:this.canvas.height};return this.frameGroup.push(h),this.graphControll=void 0,m.pushFrames(this.key,[h]),h},this.putDraft=(t,e=0,r=0)=>{const{width:i,height:a}=this.canvas;t?t instanceof ImageData?this.ctx.putImageData(t,e,r):(this.ctx.fillStyle=`rgb(${t.join(",")} )`,this.ctx.fillRect(0,0,i,a)):this.ctx.clearRect(0,0,i,a)},this.parseBlock=async()=>{if(!this.st)return;const t={sentinel:this.st.readByte(),type:""},e=()=>(t.type="complete",this.st=null,this.key="",t);switch(String.fromCharCode(t.sentinel)){case"!":return t.type="ext",this.parseExt(t);case",":return t.type="img",this.parseImg(t);case";":return e();case"\0":return e();default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}},this.parse=async(t,e,r)=>{if(this.st)return;this.st=t,this.key=e,r&&(this.opacity=r.opacity);const i=[],a=this.parseHeader();for(;this.st;){const n=await this.parseBlock();n&&i.push(n)}const c={header:a,blocks:i,frameGroup:this.frameGroup,opacity:this.opacity};return m.setComplete(e),c},this.ctx=this.canvas.getContext("2d")}get pos(){var t;return((t=this.st)==null?void 0:t.pos)||0}get len(){var t;return((t=this.st)==null?void 0:t.data.length)||0}get loading(){return!!this.st}setCanvasSize(t,e){this.canvas.width=t,this.canvas.height=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.ctx.setTransform(1,0,0,1,0,0)}disposal(t){const e=r=>{var i;const a=this.frameGroup[r];a?this.putDraft(a.data,a.leftPos,a.topPos):this.putDraft(((i=this.header)==null?void 0:i.backgroundColor)||null)};switch(t){case 3:e(this.frameGroup.length-1);break;case 2:e(-1);break}}}const vt=async(s,t,e)=>await new wt().parse(s,t,e),G=async(s,t,e)=>{const r=m.getDecodeStatus(t);let i;if(r==="decoded")return m.getDecodeData(t);if(r==="none"){i=Date.now(),m.addRecord(t);const a=new pt(s);vt(a,t,e)}return await new Promise(a=>{const c=()=>{m.off("decoded",c),a(void 0)};m.on("decoded",c)}),i&&console.log(`\u3010${t}\u3011decode time: ${Date.now()-i}`),m.getDecodeData(t)};class Dt extends T{constructor(){super(),this.draftCanvas=document.createElement("canvas"),this.opacity=255,this.drawError=t=>{if(!this.canvas||!this.ctx)return;this.ctx.fillStyle="black";const e=this.canvas.width,r=this.canvas.height;this.ctx.fillRect(0,0,e,r),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.moveTo(0,0),this.ctx.lineTo(e,r),this.ctx.moveTo(0,r),this.ctx.lineTo(e,0),this.ctx.stroke()},this.resizeObserver=new ResizeObserver(this.onResize.bind(this)),this.draftCtx=this.draftCanvas.getContext("2d")}get showProgressBar(){var t;return((t=this.canvas)==null?void 0:t.getAttribute("progress_bar"))!=="none"}get scale(){var t,e;const r=((t=this.canvas)==null?void 0:t.width)||0,i=this.draftCanvas.width,a=((e=this.canvas)==null?void 0:e.height)||0,c=this.draftCanvas.height;return{zoomW:r/i,zoomH:a/c}}updateScale(){var t,e;(t=this.ctx)==null||t.setTransform(1,0,0,1,0,0);const{zoomW:r,zoomH:i}=this.scale;(e=this.ctx)==null||e.scale(r,i)}onResize(){!this.canvas||!this.ctx||(this.updateScale(),this.drawDraft())}mount(t){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.resizeObserver.observe(t)}setDraftSize(t){!this.canvas||(this.draftCanvas.width=t.width,this.draftCanvas.height=t.height,this.draftCanvas.style.width=t.width+"px",this.draftCanvas.style.height=t.height+"px",this.draftCtx.setTransform(1,0,0,1,0,0),this.updateScale())}drawProgress(t){if(!this.canvas||this.canvas.getAttribute("progress")!=="progress"||t>1||t<0||!this.showProgressBar)return;const{zoomW:e,zoomH:r}=this.scale;let i=1;const a=(this.canvas.height-i)/r,c=t*this.canvas.width/e;i=i/r;const n=this.canvas.width/e;!this.ctx||(this.ctx.fillStyle="rgba(255,255,255,0.4)",this.ctx.fillRect(c,a,n-c,i),this.ctx.fillStyle="rgba(0,123,255,0.4)",this.ctx.fillRect(0,a,c,i))}putDraft(t,e=0,r=0){const{width:i,height:a}=this.draftCanvas;t?t instanceof ImageData?this.draftCtx.putImageData(t,e,r,0,0,i,a):(this.draftCtx.fillStyle=`rgb(${t.join(",")} )`,this.draftCtx.fillRect(0,0,i,a)):this.draftCtx.clearRect(0,0,i,a)}drawDraft(){var t;(t=this.ctx)==null||t.drawImage(this.draftCanvas,0,0)}}const x={UNDOWNLOAD:0,DOWNLOADING:1,DOWNLOADED:2,DECODING:3,DECODED:4},bt=s=>{const t=new T,e=Object.assign({opacity:255},s),r=e.gif;let i,a=r.getAttribute("src")||"";const c=new Dt;c.mount(r);const n=new ut({viewer:c}),h=o=>(...p)=>{o(...p);const v=w.getDownload(a);v!=null&&v.progress&&c.drawProgress(v.progress)},f=o=>{o.key===a&&c.drawProgress(o.progress)},l=o=>{o.key===a&&(n.onError(),c.drawError(o.error||""))};w.on("progress",h(f)),w.on("error",h(l));const d=async o=>{a=o;const p=m.getDecodeStatus(o),v=w.getDownloadStatus(o);try{if(p==="decoded")i=x.DECODED,n.switch(o);else if(p!=="none")i=x.DECODING,n.switch(o);else if(v==="downloaded"){i=x.DOWNLOADED;const D=await w.getDownload(o);n.switch(o),await G(D.data,o,{opacity:e.opacity}),i=x.DECODED}else if(v!=="none"){i=x.DOWNLOADING;const D=await U(o);i=x.DOWNLOADED,n.switch(o),await G(D.data,o,{opacity:e.opacity}),i=x.DECODED}else{i=x.UNDOWNLOAD;const D=await U(o);i=x.DOWNLOADED,n.switch(o),await G(D.data,o,{opacity:e.opacity}),i=x.DECODED}}catch{c.drawError(`load url error with\u3010${o}\u3011`)}};r.getAttribute("preload"),r.getAttribute("autoplay")&&d(a);const u={get playing(){return n.playing},get forward(){return n.forward},get loopCount(){return n.loopCount},get currentKey(){return n.currentKey},get currentFrameNo(){return n.currentFrameNo},play:n.play,pause:n.pause,loadUrl:d,getDecodeData:m.getDecodeData,getDownload:w.getDownload,on:t.on.bind(t),off:t.off.bind(t)};return n.on("play",o=>t.emit("play",o)),n.on("frameChange",o=>t.emit("frameChange",o)),n.on("pause",o=>t.emit("pause",o)),m.on("decoded",o=>t.emit("decoded",o)),w.on("downloaded",o=>t.emit("downloaded",o)),r.controller=u,u},xt=()=>{const s=document.getElementById("useDemo"),t=R[1],e=Math.random().toString().slice(2),r=200,i=200;let a=1,c=1;s.innerHTML=` 
    <div style="margin: 8px 0">
     ${R.map((o,p)=>`<button url="${o}">GIF${p}</button>`).join(" ")}
    </div>
    <div>
    <label>
      <span>width scale:</span>
      <input id="scaleXInput" type="range" max=20 min=1 step=2 value=${a*10}/>
    </label>
    <label>
      <span>height scale:</span>
      <input id="scaleYInput" type="range" max=20 min=1 step=2 value=${c*10}/>
    </label>
    </div>
    <canvas
      id="${e}"
      src="${t}" 
      width="${r}"
      height="${i}" 
      poster="poster"
      autoplay="autoplay"
    /> 
  `;const n=document.getElementById(e),h=document.getElementById("scaleXInput"),f=()=>{const o=h.value;a=parseInt(h.value)/10,h.setAttribute("value",o),n.width=r*a},l=()=>{const o=d.value;c=parseInt(d.value)/10,d.setAttribute("value",o),n.height=i*c};h&&(h.oninput=f);const d=document.getElementById("scaleYInput");d&&(d.oninput=l);const u=bt({gif:n});return console.log(u),window.r=u,s.addEventListener("click",o=>{if(o.target instanceof HTMLElement){const p=o.target.getAttribute("url");p&&u.loadUrl(p)}}),u};xt();
