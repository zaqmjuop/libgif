(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();const F="/libgif/assets/coug3.f85a27a3.gif",$="/libgif/assets/earth.b0acdc9a.gif",M="/libgif/assets/img5.64bf3f88.gif",H="/libgif/assets/gif1.5bf04440.gif",N="/libgif/assets/gif2.ba77dc11.gif",U="/libgif/assets/gif3.0e5e59d6.gif",_=[F,$,H,N,U,M];function z(l){return{all:l=l||new Map,on:function(t,e){var i=l.get(t);i?i.push(e):l.set(t,[e])},off:function(t,e){var i=l.get(t);i&&(e?i.splice(i.indexOf(e)>>>0,1):l.set(t,[]))},emit:function(t,e){var i=l.get(t);i&&i.slice().map(function(s){s(e)}),(i=l.get("*"))&&i.slice().map(function(s){s(t,e)})}}}class B{constructor(){this.emitter=z()}on(t,e){return this.emitter.on(t,e)}off(t,e){return this.emitter.off(t,e)}emit(t,e){return this.emitter.emit(t,e)}}class L extends B{constructor(){super(...arguments),this._loading=!1,this.load_raw=t=>{this._loading||(this._loading=!0,this.onLoad(t))}}get loading(){return this._loading}async load_url(t){return this._loading?void 0:(this._loading=!0,new Promise((e,i)=>{const s=new XMLHttpRequest;s.open("GET",t,!0),"overrideMimeType"in s?s.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in s?s.responseType="arraybuffer":s.setRequestHeader("Accept-Charset","x-user-defined"),s.onloadstart=()=>{this.emit("loadstart")},s.onload=r=>{s.status!=200&&(this.emit("error","xhr - response"),i("xhr - response")),"response"in s||Object.assign(this,{response:new window.VBArray(s.responseText).toArray().map(String.fromCharCode).join("")});let a="";typeof s.response=="string"?a=s.response:s.response.toString().indexOf("ArrayBuffer")>0&&(a=new Uint8Array(s.response)),e(a),this.onLoad(a)},s.onprogress=r=>{this.emit("progress",r)},s.onerror=()=>{this.emit("error","xhr"),i("xhr")},s.send()}))}onLoad(t){this._loading=!1,this.emit("load",t)}}const I=(l,t)=>{let e=0;const i=p=>{let m=0;for(let f=0;f<p;f++)(t instanceof Uint8Array?t[e>>3]:t.charCodeAt(e>>3))&1<<(e&7)&&(m|=1<<f),e++;return m},s=[],r=1<<l,a=r+1;let n=l+1,o=[];const d=()=>{n=l+1,o=[];for(let p=0;p<r;p++)o[p]=[p];o[r]=[],o[a]=null};let h=0,u;for(;;){if(u=h,h=i(n),h===r){d();continue}else{if(h===a)break;if(h>o.length)throw new Error("Invalid LZW code.");h===o.length?o.push(o[u].concat(o[u][0])):u!==r&&o.push(o[u].concat(o[h][0]))}if(s.push(...o[h]),o.length===1<<n&&n<12&&n++,e>=t.length*8)break}return s},C=l=>l.reduce((t,e)=>t*2+Number(e),0),k=l=>{const t=[];for(let e=7;e>=0;e--)t.push(!!(l&1<<e));return t};class R{constructor(t){this.pos=0,this.data=t,this.len=this.data.length}readByte(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return this.data instanceof Uint8Array?this.data[this.pos++]:this.data.charCodeAt(this.pos++)&255}readBytes(t){const e=[];for(let i=0;i<t;i++)e.push(this.readByte());return e}read(t){let e="";for(let i=0;i<t;i++)e+=String.fromCharCode(this.readByte());return e}readUnsigned(){const[t,e]=this.readBytes(2);return(e<<8)+t}}const O=()=>{let l=0;return()=>`${l++}`},W=l=>{const t=O(),e=`
    const func = ${l.toString()};
    onmessage= async (event) => {
      const { traceId, args } = event.data
      const data = await func.apply(void 0, args)
      self.postMessage({ traceId, data })
    };
  `,i=new Worker(`data:application/javascript,${encodeURIComponent(e)}`);return async(...s)=>{const r=t();return new Promise(a=>{i.onmessage=n=>{n.data.traceId===r&&a(n.data.data)},i.postMessage({args:s,traceId:r})})}},q=!1;W(I);class j extends B{constructor(){super(),this.canvas=document.createElement("canvas"),this.st=null,this.exts=[],this.opacity=255,this.frameGroup=[],this.parseColorTable=t=>{if(!this.st)return;const e=[];for(let i=0;i<t;i++)e.push(this.st.readBytes(3));return e},this.readSubBlocks=()=>{if(!this.st)return;let t,e;e="";do t=this.st.readByte(),e+=this.st.read(t);while(t!==0);return e},this.parseHeader=()=>{if(!this.st)return;const t=this.st.read(3),e=this.st.read(3);if(t!=="GIF")throw new Error("Not a GIF file.");const i=this.st.readUnsigned(),s=this.st.readUnsigned(),r=k(this.st.readByte()),a=!!r.shift(),n=C(r.splice(0,3)),o=!!r.shift(),d=C(r.splice(0,3)),h=this.st.readByte(),u=this.st.readByte(),p=a?this.parseColorTable(1<<d+1):void 0,m=p?p[h]:null,f={signature:t,version:e,logicalScreenWidth:i,logicalScreenHeight:s,globalColorTableFlag:a,ColorResolution:n,sortFlag:o,ColorTableSize:d,backgroundColorIndex:h,backgroundColor:m,pixelAspectRatio:u,globalColorTable:p};this.header=f,this.setCanvasSize(f.logicalScreenWidth,f.logicalScreenHeight),this.emit("header",f)},this.parseExt=t=>{if(!this.st)return;const e=d=>{if(!this.st)return;this.st.readByte();const h=k(this.st.readByte()),u=h.splice(0,3),p=C(h.splice(0,3)),m=!!h.shift(),f=!!h.shift(),c=this.st.readUnsigned()*10,g=this.st.readByte(),y=this.st.readByte(),w={...d,reserved:u,disposalMethod:p,userInput:m,transparencyGiven:f,delayTime:c,transparencyIndex:g,terminator:y};this.graphControll=w},i=d=>{if(!this.st)return;const h=this.readSubBlocks(),u={...d,comment:h};this.exts.push(u),this.emit("com",u)},s=d=>{if(!this.st)return;this.st.readByte();const h=this.st.readBytes(12),u=this.readSubBlocks(),p={...d,ptHeader:h,ptData:u};this.exts.push(p),this.emit("pte",p)},r=d=>{if(!this.st)return;const h=c=>{if(!this.st)return;this.st.readByte();const g=this.st.readByte(),y=this.st.readUnsigned(),w=this.st.readByte(),v={...c,unknown:g,iterations:y,terminator:w,identifier:"NETSCAPE"};this.app=v,this.emit("app",v)},u=c=>{const g=this.readSubBlocks(),y={...c,appData:g,identifier:c.identifier};this.app=y,this.emit("app",y)};this.st.readByte();const p=this.st.read(8),m=this.st.read(3),f={...d,identifier:p,authCode:m};switch(f.identifier){case"NETSCAPE":h(f);break;default:u(f);break}},a=d=>{const h=this.readSubBlocks(),u={...d,data:h};this.exts.push(u),this.emit("unknown",u)},n=this.st.readByte(),o={...t,label:n,extType:""};switch(o.label){case 249:o.extType="gce",e(o);break;case 254:o.extType="com",i(o);break;case 1:o.extType="pte",s(o);break;case 255:o.extType="app",r(o);break;default:o.extType="unknown",a(o);break}},this.parseImg=async t=>{if(!this.st)return;const e=(w,v)=>{const S=new Array(w.length),E=w.length/v,G=(b,x)=>{const D=w.slice(x*v,(x+1)*v);S.splice(b*v,v,...D)},P=[0,4,2,1],A=[8,8,4,2];let T=0;for(let b=0;b<4;b++)for(let x=P[b];x<E;x+=A[b])G(x,T),T++;return S},i=this.st.readUnsigned(),s=this.st.readUnsigned(),r=this.st.readUnsigned(),a=this.st.readUnsigned(),n=k(this.st.readByte()),o=n.shift(),d=n.shift(),h=n.shift(),u=n.splice(0,2),p=C(n.splice(0,3)),m=o?this.parseColorTable(1<<p+1):void 0,f=this.st.readByte(),c=this.readSubBlocks();let g=I(f,c);d&&(g=e(g,r));const y={...t,leftPos:i,topPos:s,width:r,height:a,lctFlag:o,interlaced:d,sorted:h,reserved:u,lctSize:p,lct:m,lzwMinCodeSize:f,pixels:g};this.parseFrame(y)},this.parseFrame=t=>{var e;const i=this.graphControll;i&&this.disposal(i.disposalMethod);const s=i&&i.transparencyGiven?i.transparencyIndex:null,r=i&&i.delayTime||100,a=t.lctFlag?t.lct:(e=this.header)==null?void 0:e.globalColorTable,n=this.getDraft(t);a&&t.pixels.forEach((d,h)=>{d!==s&&(n.data[h*4+0]=a[d][0],n.data[h*4+1]=a[d][1],n.data[h*4+2]=a[d][2],n.data[h*4+3]=this.opacity)});const o={data:n,delay:r,leftPos:t.leftPos,topPos:t.topPos,width:this.canvas.width,height:this.canvas.height};this.frameGroup.push(o),this.graphControll=void 0,this.emit("frame",o)},this.putDraft=(t,e=0,i=0)=>{const{width:s,height:r}=this.canvas;t?t instanceof ImageData?this.ctx.putImageData(t,e,i):(this.ctx.fillStyle=`rgb(${t.join(",")} )`,this.ctx.fillRect(0,0,s,r)):this.ctx.clearRect(0,0,s,r)},this.getDraft=t=>this.ctx.getImageData(t.leftPos,t.topPos,t.width,t.height),this.parseBlock=async()=>{if(!this.st)return;const t={sentinel:this.st.readByte(),type:""};switch(String.fromCharCode(t.sentinel)){case"!":t.type="ext",this.parseExt(t);break;case",":t.type="img",await this.parseImg(t);break;case";":t.type="complete",this.st=null,this.emit("complete",{...t,header:this.header,frameGroup:this.frameGroup,opacity:this.opacity});break;case"\0":t.type="complete",this.st=null,this.emit("complete",{...t,header:this.header,frameGroup:this.frameGroup,opacity:this.opacity});break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}t.type!=="complete"&&setTimeout(this.parseBlock,0)},this.parse=(t,e)=>{this.st||(this.st=t,e&&(this.opacity=e.opacity),this.parseHeader(),setTimeout(this.parseBlock,0))},this.ctx=this.canvas.getContext("2d")}get pos(){var t;return((t=this.st)==null?void 0:t.pos)||0}get len(){var t;return((t=this.st)==null?void 0:t.data.length)||0}get loading(){return!!this.st}setCanvasSize(t,e){this.canvas.width=t,this.canvas.height=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.ctx.setTransform(1,0,0,1,0,0)}disposal(t){const e=i=>{var s;const r=this.frameGroup[i];r?this.putDraft(r.data,r.leftPos,r.topPos):this.putDraft(((s=this.header)==null?void 0:s.backgroundColor)||null)};switch(t){case 3:e(this.frameGroup.length-1);break;case 2:e(-1);break}}}class K extends B{constructor(t){super(),this.i=-1,this.iterationCount=0,this.forward=!0,this.playing=!1,this.frameGroup=[],this.opacity=255,this.timestamp=0,this.t=0,this.finish=()=>{this.iterationCount++,this.emit("finish"),this.quote.overrideLoopMode||this.iterationCount<1?this.goOn():this.pause()},this.goOn=()=>{if(!this.playing)return;this.putFrameBy(1);const e=this.frameGroup[this.i].delay,i=this.getNextFrameNo()===0;clearTimeout(this.t),this.t=i?window.setTimeout(this.finish,e):window.setTimeout(this.goOn,e)},this.putFrameBy=e=>{this.i=this.i+e,this.putFrame()},this.play=()=>{this.playing||(this.playing=!0,this.goOn())},this.pause=()=>{this.playing=!1},this.move_to=e=>{this.i=e,this.putFrame()},this.resetState=()=>{clearTimeout(this.t),this.i=-1,this.iterationCount=0,this.forward=!0,this.playing=!1,this.frameGroup=[],this.opacity=255,this.timestamp=0},this.onHeader=e=>{this.resetState(),this.quote.viewer.adapt({width:e.logicalScreenWidth,height:e.logicalScreenHeight})},this.onFrame=e=>{this.frameGroup.push(e),this.play()},this.onError=()=>{this.resetState()},this.quote=t}getNextFrameNo(){const t=this.forward?1:-1;return(this.i+t+this.frameGroup.length)%this.frameGroup.length}putFrame(t){typeof t=="number"&&(this.i=t),(this.i<0||this.i>=this.frameGroup.length)&&(this.i=0);const e=this.frameGroup[this.i];this.quote.viewer.putDraft(e.data,e.leftPos,e.topPos),this.quote.viewer.drawDraft()}current_frame(){return this.i}}class V{constructor(){this.canvas=document.createElement("canvas"),this.draftCanvas=document.createElement("canvas"),this.opacity=255,this.zoomW=1,this.zoomH=1,this.drawError=t=>{console.error(t),this.ctx.fillStyle="black";const e=this.canvas.width,i=this.canvas.height;this.ctx.fillRect(0,0,e,i),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.moveTo(0,0),this.ctx.lineTo(e,i),this.ctx.moveTo(0,i),this.ctx.lineTo(e,0),this.ctx.stroke()},this.ctx=this.canvas.getContext("2d"),this.draftCtx=this.draftCanvas.getContext("2d")}get showProgressBar(){var t;return((t=this.$el)==null?void 0:t.getAttribute("progress_bar"))!=="none"}get isMounted(){var t;return!!((t=this.canvas.parentNode)!=null&&t.parentNode)}mount(t){if(this.isMounted)return;const e=t.parentNode;if(!e)return;this.$el=t;const i=document.createElement("div");i.style.display="inline-block";const s=Number(t.getAttribute("width"))||0,r=Number(t.getAttribute("height"))||0;this.canvas.id="\u91CD\u6784",this.canvas.style.display="block",this.canvas.width=s,this.canvas.height=r,i.appendChild(this.canvas),e.insertBefore(i,t),e.removeChild(t)}adapt(t){if(!this.$el)return;const e=this.$el.getAttribute("width"),i=e?parseInt(e):t.width,s=i/t.width,r=this.$el.getAttribute("height"),a=r?parseInt(r):t.height,n=a/t.height;this.canvas.width=i,this.canvas.height=a,this.ctx.scale(s,n),this.zoomW=s,this.zoomH=n,this.draftCanvas.width=t.width,this.draftCanvas.height=t.height,this.draftCanvas.style.width=t.width+"px",this.draftCanvas.style.height=t.height+"px",this.draftCtx.setTransform(1,0,0,1,0,0)}drawProgress(t){if(t>1||t<0||!this.showProgressBar)return;let e=1;const i=(this.canvas.height-e)/this.zoomH,s=t*this.canvas.width/this.zoomW;e=e/this.zoomH;const r=this.canvas.width/this.zoomW;this.ctx.fillStyle="rgba(255,255,255,0.4)",this.ctx.fillRect(s,i,r-s,e),this.ctx.fillStyle="rgba(0,123,255,0.4)",this.ctx.fillRect(0,i,s,e)}getDraft(t){return this.draftCtx.getImageData(t.leftPos,t.topPos,t.width,t.height)}putDraft(t,e=0,i=0){const{width:s,height:r}=this.draftCanvas;t?t instanceof ImageData?this.draftCtx.putImageData(t,e,i):(this.draftCtx.fillStyle=`rgb(${t.join(",")} )`,this.draftCtx.fillRect(0,0,s,r)):this.draftCtx.clearRect(0,0,s,r)}drawDraft(){this.ctx.drawImage(this.draftCanvas,0,0)}}const X=l=>{let t=0;const e=new B,i=Object.assign({},l),s=i.gif,r=new V;r.mount(s);const a=new K({overrideLoopMode:i.loop_mode!==!1,viewer:r});a.on("finish",()=>e.emit("finish",s));const n=new j,o=c=>(...g)=>{c(...g),r.drawProgress(n.pos/n.len)};n.on("header",o(c=>{a.onHeader(c)})),n.on("frame",o(c=>{a.onFrame(c)})),n.on("complete",o(c=>{e.emit("load",s)}));const d=new L;d.on("load",c=>{}),d.on("progress",c=>{c.lengthComputable&&r.drawProgress(c.loaded/c.total)}),d.on("error",c=>{a.onError(),r.drawError(c)});const h=()=>d.loading||n.loading,u=c=>{if(!h())try{const g=new R(c);return q&&(t=Date.now()),n.parse(g)}catch{r.drawError(`load raw error with\u3010${c.slice(0,8)}\u3011`)}},p=async c=>{if(!h())try{const g=await d.load_url(c);return m(g)}catch{r.drawError(`load url error with\u3010${c}\u3011`)}},m=c=>u(c),f=()=>p(s.getAttribute("rel:animated_src")||s.getAttribute("src")||"");return{player:a,play:a.play,pause:a.pause,move_relative:a.putFrameBy,move_to:a.move_to,get_playing:()=>a.playing,get_current_frame:()=>a.current_frame(),get_canvas:()=>r.canvas,get_loading:h,get_auto_play:()=>i,load_url:p,load:f,load_raw:m,get frames(){return a.frameGroup},get_length:()=>a.frameGroup.length,on:e.on,off:e.off}},Z=()=>{const l=document.getElementById("useDemo"),t=_[1],e=Math.random().toString().slice(2);l.innerHTML=` 
    <div style="margin: 8px 0">
     ${_.map((r,a)=>`<button url="${r}">GIF${a}</button>`).join(" ")}
    </div>
    <div
    id="${e}"
    src="${t}"
    rel:animated_src="${t}"
    width="300"
    height="300"
    rel:auto_play="1"
    rel:rubbable="1"
    /> 
  `;const i=document.getElementById(e),s=X({gif:i});return s.load(),l.addEventListener("click",r=>{if(r.target instanceof HTMLElement){const a=r.target.getAttribute("url");a&&s.load_url(a)}}),s};Z();
