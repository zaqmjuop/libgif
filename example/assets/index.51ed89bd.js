(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();const $="/assets/coug3.f85a27a3.gif",H="/assets/earth.b0acdc9a.gif",N="/assets/img5.64bf3f88.gif",L="/assets/gif1.5bf04440.gif",M="/assets/gif2.ba77dc11.gif",U="/assets/gif3.0e5e59d6.gif",_=[$,H,L,M,U,N];function z(c){return{all:c=c||new Map,on:function(t,e){var s=c.get(t);s?s.push(e):c.set(t,[e])},off:function(t,e){var s=c.get(t);s&&(e?s.splice(s.indexOf(e)>>>0,1):c.set(t,[]))},emit:function(t,e){var s=c.get(t);s&&s.slice().map(function(r){r(e)}),(s=c.get("*"))&&s.slice().map(function(r){r(t,e)})}}}class B{constructor(){this.emitter=z()}on(t,e){return this.emitter.on(t,e)}off(t,e){return this.emitter.off(t,e)}emit(t,e){return this.emitter.emit(t,e)}}class R extends B{constructor(){super(...arguments),this._loading=!1,this.load_raw=t=>{this._loading||(this._loading=!0,this.onLoad(t))}}get loading(){return this._loading}async load_url(t){return this._loading?void 0:(this._loading=!0,new Promise((s,r)=>{const i=new XMLHttpRequest;i.open("GET",t,!0),"overrideMimeType"in i?i.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in i?i.responseType="arraybuffer":i.setRequestHeader("Accept-Charset","x-user-defined"),i.onloadstart=()=>{this.emit("loadstart")},i.onload=o=>{i.status!=200&&(this.emit("error","xhr - response"),r("xhr - response")),"response"in i||Object.assign(this,{response:new window.VBArray(i.responseText).toArray().map(String.fromCharCode).join("")});let n="";typeof i.response=="string"?n=i.response:i.response.toString().indexOf("ArrayBuffer")>0&&(n=new Uint8Array(i.response)),s(n),this.onLoad(n)},i.onprogress=o=>{this.emit("progress",o)},i.onerror=()=>{this.emit("error","xhr"),r("xhr")},i.send()}))}onLoad(t){this._loading=!1,this.emit("load",t)}}const k=c=>c.reduce((t,e)=>t*2+Number(e),0),E=c=>{const t=[];for(let e=7;e>=0;e--)t.push(!!(c&1<<e));return t};class W{constructor(t){this.pos=0,this.data=t,this.len=this.data.length}readByte(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return this.data instanceof Uint8Array?this.data[this.pos++]:this.data.charCodeAt(this.pos++)&255}readBytes(t){const e=[];for(let s=0;s<t;s++)e.push(this.readByte());return e}read(t){let e="";for(let s=0;s<t;s++)e+=String.fromCharCode(this.readByte());return e}readUnsigned(){const[t,e]=this.readBytes(2);return(e<<8)+t}}const O=!0,q=()=>{let c=0;return()=>c++},P=c=>{const t=new Worker("/assets/funcWorker.b86fc165.js",{type:"module"}),e=q();return async(...r)=>{const i=e();return new Promise(o=>{const n=h=>{h.data.traceId===i&&(t.removeEventListener("message",n),o(h.data.data))};t.addEventListener("message",n),t.postMessage({args:r,traceId:i,funcName:c})})}},j={"":P(""),lzwDecode:P("lzwDecode")};class V extends B{constructor(){super(),this.canvas=document.createElement("canvas"),this.st=null,this.exts=[],this.opacity=255,this.frameGroup=[],this.parseColorTable=t=>{if(!this.st)return;const e=[];for(let s=0;s<t;s++)e.push(this.st.readBytes(3));return e},this.readSubBlocks=()=>{if(!this.st)return;let t,e;e="";do t=this.st.readByte(),e+=this.st.read(t);while(t!==0);return e},this.parseHeader=()=>{if(!this.st)return;let t=Date.now();const e=this.st.read(3),s=this.st.read(3);if(e!=="GIF")throw new Error("Not a GIF file.");const r=this.st.readUnsigned(),i=this.st.readUnsigned(),o=E(this.st.readByte()),n=!!o.shift(),h=k(o.splice(0,3)),d=!!o.shift(),l=k(o.splice(0,3)),p=this.st.readByte(),f=this.st.readByte(),g=n?this.parseColorTable(1<<l+1):void 0,m=g?g[p]:null,a={signature:e,version:s,logicalScreenWidth:r,logicalScreenHeight:i,globalColorTableFlag:n,ColorResolution:h,sortFlag:d,ColorTableSize:l,backgroundColorIndex:p,backgroundColor:m,pixelAspectRatio:f,globalColorTable:g};this.header=a,this.setCanvasSize(a.logicalScreenWidth,a.logicalScreenHeight),console.log(`parseHeader time: ${Date.now()-t}`),this.emit("header",a)},this.parseExt=t=>{if(!this.st)return;const e=d=>{if(!this.st)return;this.st.readByte();const l=E(this.st.readByte()),p=l.splice(0,3),f=k(l.splice(0,3)),g=!!l.shift(),m=!!l.shift(),a=this.st.readUnsigned()*10,u=this.st.readByte(),y=this.st.readByte(),v={...d,reserved:p,disposalMethod:f,userInput:g,transparencyGiven:m,delayTime:a,transparencyIndex:u,terminator:y};this.graphControll=v},s=d=>{if(!this.st)return;const l=this.readSubBlocks(),p={...d,comment:l};this.exts.push(p),this.emit("com",p)},r=d=>{if(!this.st)return;this.st.readByte();const l=this.st.readBytes(12),p=this.readSubBlocks(),f={...d,ptHeader:l,ptData:p};this.exts.push(f),this.emit("pte",f)},i=d=>{if(!this.st)return;const l=a=>{if(!this.st)return;this.st.readByte();const u=this.st.readByte(),y=this.st.readUnsigned(),v=this.st.readByte(),w={...a,unknown:u,iterations:y,terminator:v,identifier:"NETSCAPE"};this.app=w,this.emit("app",w)},p=a=>{const u=this.readSubBlocks(),y={...a,appData:u,identifier:a.identifier};this.app=y,this.emit("app",y)};this.st.readByte();const f=this.st.read(8),g=this.st.read(3),m={...d,identifier:f,authCode:g};switch(m.identifier){case"NETSCAPE":l(m);break;default:p(m);break}},o=d=>{const l=this.readSubBlocks(),p={...d,data:l};this.exts.push(p),this.emit("unknown",p)},n=this.st.readByte(),h={...t,label:n,extType:""};switch(h.label){case 249:h.extType="gce",e(h);break;case 254:h.extType="com",s(h);break;case 1:h.extType="pte",r(h);break;case 255:h.extType="app",i(h);break;default:h.extType="unknown",o(h);break}},this.parseImg=async t=>{if(!this.st)return;let e=Date.now();const s=(w,C)=>{const T=new Array(w.length),S=w.length/C,G=(b,x)=>{const A=w.slice(x*C,(x+1)*C);T.splice(b*C,C,...A)},F=[0,4,2,1],I=[8,8,4,2];let D=0;for(let b=0;b<4;b++)for(let x=F[b];x<S;x+=I[b])G(x,D),D++;return T},r=this.st.readUnsigned(),i=this.st.readUnsigned(),o=this.st.readUnsigned(),n=this.st.readUnsigned(),h=E(this.st.readByte()),d=h.shift(),l=h.shift(),p=h.shift(),f=h.splice(0,2),g=k(h.splice(0,3)),m=d?this.parseColorTable(1<<g+1):void 0,a=this.st.readByte(),u=this.readSubBlocks();let y=await j.lzwDecode(a,u);console.log(`lzwDecode time: ${Date.now()-e}`),l&&(y=s(y,o),console.log(`deinterlace time: ${Date.now()-e}`));const v={...t,leftPos:r,topPos:i,width:o,height:n,lctFlag:d,interlaced:l,sorted:p,reserved:f,lctSize:g,lct:m,lzwMinCodeSize:a,pixels:y};console.log(`parseImg time: ${Date.now()-e}`),this.parseFrame(v)},this.parseFrame=t=>{var d;let e=Date.now();const s=this.graphControll;s&&this.disposal(s.disposalMethod);const r=s&&s.transparencyGiven?s.transparencyIndex:null,i=s&&s.delayTime||100,o=t.lctFlag?t.lct:(d=this.header)==null?void 0:d.globalColorTable,n=this.getDraft(t);o&&t.pixels.forEach((l,p)=>{l!==r&&(n.data[p*4+0]=o[l][0],n.data[p*4+1]=o[l][1],n.data[p*4+2]=o[l][2],n.data[p*4+3]=this.opacity)});const h={data:n,delay:i,leftPos:t.leftPos,topPos:t.topPos,width:this.canvas.width,height:this.canvas.height};this.frameGroup.push(h),this.graphControll=void 0,console.log(`parseFrame time: ${Date.now()-e}`),this.emit("frame",h)},this.putDraft=(t,e=0,s=0)=>{const{width:r,height:i}=this.canvas;t?t instanceof ImageData?this.ctx.putImageData(t,e,s):(this.ctx.fillStyle=`rgb(${t.join(",")} )`,this.ctx.fillRect(0,0,r,i)):this.ctx.clearRect(0,0,r,i)},this.getDraft=t=>this.ctx.getImageData(t.leftPos,t.topPos,t.width,t.height),this.parseBlock=async()=>{if(!this.st)return;let t=Date.now();const s={sentinel:this.st.readByte(),type:""};switch(String.fromCharCode(s.sentinel)){case"!":s.type="ext",this.parseExt(s);break;case",":s.type="img",await this.parseImg(s);break;case";":s.type="complete",this.st=null,this.emit("complete",{...s,header:this.header,frameGroup:this.frameGroup,opacity:this.opacity});break;case"\0":s.type="complete",this.st=null,this.emit("complete",{...s,header:this.header,frameGroup:this.frameGroup,opacity:this.opacity});break;default:throw new Error("Unknown block: 0x"+s.sentinel.toString(16))}console.log(`parseBlock time: ${Date.now()-t}, type:${s.type}`),s.type!=="complete"&&setTimeout(this.parseBlock,0)},this.parse=(t,e)=>{this.st||(this.st=t,e&&(this.opacity=e.opacity),this.parseHeader(),setTimeout(this.parseBlock,0))},this.ctx=this.canvas.getContext("2d")}get pos(){var t;return((t=this.st)==null?void 0:t.pos)||0}get len(){var t;return((t=this.st)==null?void 0:t.data.length)||0}get loading(){return!!this.st}setCanvasSize(t,e){this.canvas.width=t,this.canvas.height=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.ctx.setTransform(1,0,0,1,0,0)}disposal(t){const e=s=>{var i;const r=this.frameGroup[s];r?this.putDraft(r.data,r.leftPos,r.topPos):this.putDraft(((i=this.header)==null?void 0:i.backgroundColor)||null)};switch(t){case 3:e(this.frameGroup.length-1);break;case 2:e(-1);break}}}class K extends B{constructor(t){super(),this.i=-1,this.iterationCount=0,this.forward=!0,this.playing=!1,this.frameGroup=[],this.opacity=255,this.timestamp=0,this.t=0,this.finish=()=>{this.iterationCount++,this.emit("finish"),this.quote.overrideLoopMode||this.iterationCount<1?this.goOn():this.pause()},this.goOn=()=>{if(!this.playing)return;this.putFrameBy(1);const e=this.frameGroup[this.i].delay,s=this.getNextFrameNo()===0;clearTimeout(this.t),this.t=s?window.setTimeout(this.finish,e):window.setTimeout(this.goOn,e)},this.putFrameBy=e=>{this.i=this.i+e,this.putFrame()},this.play=()=>{this.playing||(this.playing=!0,this.goOn())},this.pause=()=>{this.playing=!1},this.move_to=e=>{this.i=e,this.putFrame()},this.resetState=()=>{clearTimeout(this.t),this.i=-1,this.iterationCount=0,this.forward=!0,this.playing=!1,this.frameGroup=[],this.opacity=255,this.timestamp=0},this.onHeader=e=>{this.resetState(),this.quote.viewer.adapt({width:e.logicalScreenWidth,height:e.logicalScreenHeight})},this.onFrame=e=>{this.frameGroup.push(e),this.play()},this.onError=()=>{this.resetState()},this.quote=t}getNextFrameNo(){const t=this.forward?1:-1;return(this.i+t+this.frameGroup.length)%this.frameGroup.length}putFrame(t){typeof t=="number"&&(this.i=t),(this.i<0||this.i>=this.frameGroup.length)&&(this.i=0);const e=this.frameGroup[this.i];this.quote.viewer.putDraft(e.data,e.leftPos,e.topPos),this.quote.viewer.drawDraft()}current_frame(){return this.i}}class X{constructor(){this.canvas=document.createElement("canvas"),this.draftCanvas=document.createElement("canvas"),this.opacity=255,this.zoomW=1,this.zoomH=1,this.drawError=t=>{console.error(t),this.ctx.fillStyle="black";const e=this.canvas.width,s=this.canvas.height;this.ctx.fillRect(0,0,e,s),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.moveTo(0,0),this.ctx.lineTo(e,s),this.ctx.moveTo(0,s),this.ctx.lineTo(e,0),this.ctx.stroke()},this.ctx=this.canvas.getContext("2d"),this.draftCtx=this.draftCanvas.getContext("2d")}get showProgressBar(){var t;return((t=this.$el)==null?void 0:t.getAttribute("progress_bar"))!=="none"}get isMounted(){var t;return!!((t=this.canvas.parentNode)!=null&&t.parentNode)}mount(t){if(this.isMounted)return;const e=t.parentNode;if(!e)return;this.$el=t;const s=document.createElement("div");s.style.display="inline-block";const r=Number(t.getAttribute("width"))||0,i=Number(t.getAttribute("height"))||0;this.canvas.id="\u91CD\u6784",this.canvas.style.display="block",this.canvas.width=r,this.canvas.height=i,s.appendChild(this.canvas),e.insertBefore(s,t),e.removeChild(t)}adapt(t){if(!this.$el)return;const e=this.$el.getAttribute("width"),s=e?parseInt(e):t.width,r=s/t.width,i=this.$el.getAttribute("height"),o=i?parseInt(i):t.height,n=o/t.height;this.canvas.width=s,this.canvas.height=o,this.ctx.scale(r,n),this.zoomW=r,this.zoomH=n,this.draftCanvas.width=t.width,this.draftCanvas.height=t.height,this.draftCanvas.style.width=t.width+"px",this.draftCanvas.style.height=t.height+"px",this.draftCtx.setTransform(1,0,0,1,0,0)}drawProgress(t){if(t>1||t<0||!this.showProgressBar)return;let e=1;const s=(this.canvas.height-e)/this.zoomH,r=t*this.canvas.width/this.zoomW;e=e/this.zoomH;const i=this.canvas.width/this.zoomW;this.ctx.fillStyle="rgba(255,255,255,0.4)",this.ctx.fillRect(r,s,i-r,e),this.ctx.fillStyle="rgba(0,123,255,0.4)",this.ctx.fillRect(0,s,r,e)}getDraft(t){return this.draftCtx.getImageData(t.leftPos,t.topPos,t.width,t.height)}putDraft(t,e=0,s=0){const{width:r,height:i}=this.draftCanvas;t?t instanceof ImageData?this.draftCtx.putImageData(t,e,s):(this.draftCtx.fillStyle=`rgb(${t.join(",")} )`,this.draftCtx.fillRect(0,0,r,i)):this.draftCtx.clearRect(0,0,r,i)}drawDraft(){this.ctx.drawImage(this.draftCanvas,0,0)}}const J=c=>{let t=0;const e=new B,s=Object.assign({},c),r=s.gif,i=new X;i.mount(r);const o=new K({overrideLoopMode:s.loop_mode!==!1,viewer:i});o.on("finish",()=>e.emit("finish",r));const n=new V,h=a=>(...u)=>{a(...u),i.drawProgress(n.pos/n.len)};n.on("header",h(a=>{o.onHeader(a)})),n.on("frame",h(a=>{o.onFrame(a)})),n.on("complete",h(a=>{console.log("decode time:",Date.now()-t),e.emit("load",r)}));const d=new R;d.on("load",a=>{}),d.on("progress",a=>{a.lengthComputable&&i.drawProgress(a.loaded/a.total)}),d.on("error",a=>{o.onError(),i.drawError(a)});const l=()=>d.loading||n.loading,p=a=>{if(!l())try{const u=new W(a);return O&&(t=Date.now()),n.parse(u)}catch{i.drawError(`load raw error with\u3010${a.slice(0,8)}\u3011`)}},f=async a=>{if(!l())try{const u=await d.load_url(a);return g(u)}catch{i.drawError(`load url error with\u3010${a}\u3011`)}},g=a=>p(a),m=()=>f(r.getAttribute("rel:animated_src")||r.getAttribute("src")||"");return{player:o,play:o.play,pause:o.pause,move_relative:o.putFrameBy,move_to:o.move_to,get_playing:()=>o.playing,get_current_frame:()=>o.current_frame(),get_canvas:()=>i.canvas,get_loading:l,get_auto_play:()=>s,load_url:f,load:m,load_raw:g,get frames(){return o.frameGroup},get_length:()=>o.frameGroup.length,on:e.on,off:e.off}},Q=()=>{const c=document.getElementById("useDemo"),t=_[1],e=Math.random().toString().slice(2);c.innerHTML=` 
    <div style="margin: 8px 0">
     ${_.map((i,o)=>`<button url="${i}">GIF${o}</button>`).join(" ")}
    </div>
    <div
    id="${e}"
    src="${t}"
    rel:animated_src="${t}"
    width="300"
    height="300"
    rel:auto_play="1"
    rel:rubbable="1"
    /> 
  `;const s=document.getElementById(e),r=J({gif:s});return r.load(),c.addEventListener("click",i=>{if(i.target instanceof HTMLElement){const o=i.target.getAttribute("url");o&&r.load_url(o)}}),r};Q();
